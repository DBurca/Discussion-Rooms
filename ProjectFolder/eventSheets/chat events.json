{
	"name": "Chat events",
	"events": [
		{
			"eventType": "comment",
			"text": "These global variables contain the game, game instance and room names to join. They are set as global constants so we can easily change them from a single location if we want to change any of them."
		},
		{
			"eventType": "variable",
			"name": "GAME_NAME",
			"type": "string",
			"initialValue": "DBurca-chat-v1",
			"comment": "Name of the game on the signalling server.",
			"isStatic": false,
			"isConstant": true,
			"sid": 4713255663715721
		},
		{
			"eventType": "variable",
			"name": "INSTANCE_NAME",
			"type": "string",
			"initialValue": "default",
			"comment": "Name of the instance on the signalling server.",
			"isStatic": false,
			"isConstant": true,
			"sid": 2110590493564844
		},
		{
			"eventType": "variable",
			"name": "ROOM_NAME",
			"type": "string",
			"initialValue": "main",
			"comment": "Name of the room to join on the signalling server.",
			"isStatic": false,
			"isConstant": false,
			"sid": 3459440549954199
		},
		{
			"eventType": "variable",
			"name": "ErrorText",
			"type": "string",
			"initialValue": "",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 281192099733226
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Chat log",
			"description": "A function to easily add a log message to the chat log textarea.",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "comment",
					"text": "Since a lot of events need to add something to the ChatLog, this function saves us repeating the actions to add a new line to the end of the chat log and scroll to the bottom so we can still see updates even after they go past the object height."
				},
				{
					"functionName": "AddLog",
					"functionDescription": "Automatically converted from 'AddLog'",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "message",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 288935703436318
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [
						{
							"id": "scroll-to-bottom",
							"objectClass": "ChatLog",
							"sid": 203074594726893
						},
						{
							"id": "set-text",
							"objectClass": "ChatLog",
							"sid": 426972919522404,
							"parameters": {
								"text": "(Self.Text & newline) & message"
							}
						},
						{
							"id": "scroll-to-bottom",
							"objectClass": "ChatLog",
							"sid": 183104056199413
						}
					],
					"sid": 347089708056055
				}
			],
			"sid": 426277591762612
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Audio Notifications",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "comment",
					"text": "Depending on what the user chooses on the login page, this function will send the user audio effects whenever another user sends a chat message"
				},
				{
					"functionName": "Notify",
					"functionDescription": "",
					"functionCategory": "",
					"functionReturnType": "none",
					"functionIsAsync": false,
					"functionParameters": [
						{
							"name": "text",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 717313014124614
						},
						{
							"name": "user",
							"type": "string",
							"initialValue": "",
							"comment": "",
							"sid": 673668675398898
						}
					],
					"eventType": "function-block",
					"conditions": [],
					"actions": [],
					"sid": 181876636608649,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 742400904219299,
									"parameters": {
										"variable": "Notifications",
										"comparison": 0,
										"value": "0"
									}
								}
							],
							"actions": [],
							"sid": 181607929362331
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 942185981442142,
									"parameters": {
										"variable": "ErrorText",
										"comparison": 0,
										"value": "1"
									}
								}
							],
							"actions": [
								{
									"id": "play",
									"objectClass": "Audio",
									"sid": 883740092655488,
									"parameters": {
										"audio-file": "me-too",
										"loop": "not-looping",
										"volume": "0",
										"tag-optional": "\"\""
									}
								}
							],
							"sid": 244490384855710
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 387399234810535,
									"parameters": {
										"variable": "Notifications",
										"comparison": 0,
										"value": "2"
									}
								}
							],
							"actions": [
								{
									"id": "speak-text",
									"objectClass": "SpeechSynthesis",
									"sid": 101165386913418,
									"parameters": {
										"text": "user & \" says, \" & text",
										"language": "\"\"",
										"voice-uri": "\"\"",
										"volume": "0",
										"rate": "1",
										"pitch": "1.7"
									}
								}
							],
							"sid": 181475233152475
						}
					]
				}
			],
			"sid": 787735925943686
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Signalling",
			"description": "Manages connecting to the signalling server and joining the room.",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "comment",
					"text": "On the start of the layout, connect to the signalling server."
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-start-of-layout",
							"objectClass": "System",
							"sid": 5921545419714133
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 454332300914415,
							"parameters": {
								"variable": "ROOM_NAME",
								"value": "MyRoom"
							}
						},
						{
							"id": "set-text",
							"objectClass": "ChatLog",
							"sid": 935002321629706,
							"parameters": {
								"text": "\"Connecting to server and room '\" & ROOM_NAME & \"'\""
							}
						},
						{
							"id": "log-in",
							"objectClass": "Multiplayer",
							"sid": 598868354975543,
							"parameters": {
								"alias": "MyUsername"
							}
						},
						{
							"callFunction": "Notify",
							"sid": 249243784335798,
							"parameters": [
								"\"Connecting to server and room '\" & ROOM_NAME & \"'\"",
								"\"The System\""
							]
						}
					],
					"sid": 6969574974861222,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-eventvar",
									"objectClass": "System",
									"sid": 228180625797433,
									"parameters": {
										"variable": "Notifications",
										"comparison": 1,
										"value": "2"
									}
								}
							],
							"actions": [
								{
									"id": "set-visible",
									"objectClass": "StopTTS",
									"sid": 202817707362783,
									"parameters": {
										"visibility": "invisible"
									}
								}
							],
							"sid": 325422976135057
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 825610050387521
								}
							],
							"actions": [
								{
									"id": "set-visible",
									"objectClass": "StopTTS",
									"sid": 689994338022901,
									"parameters": {
										"visibility": "visible"
									}
								}
							],
							"sid": 636916459244174
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Once successfully logged in, request to join the room. Note the user's current alias is displayed back to them, because it's possible the signalling server changed our name if it was already taken."
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-logged-in",
							"objectClass": "Multiplayer",
							"sid": 5973141943761528
						}
					],
					"actions": [
						{
							"callFunction": "AddLog",
							"sid": 145510463380498,
							"parameters": [
								"\"Logged in as '\" & Multiplayer.MyAlias & \"', joining room...\""
							]
						},
						{
							"id": "join-room",
							"objectClass": "Multiplayer",
							"sid": 6577771807422291,
							"parameters": {
								"game": "GAME_NAME",
								"instance": "INSTANCE_NAME",
								"room": "ROOM_NAME",
								"max-peers": "0"
							}
						},
						{
							"callFunction": "Notify",
							"sid": 997665439571955,
							"parameters": [
								"\"Logged in as '\" & Multiplayer.MyAlias & \"', joining room\"",
								"\"The System\""
							]
						}
					],
					"sid": 3683751236422516
				},
				{
					"eventType": "comment",
					"text": "Upon joining the room, display a different status depending on if we are the host, and add our own name to the list of peers on the right. The appropriate group of events for either the host or a peer is activated and the chat text box is enabled."
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-joined-room",
							"objectClass": "Multiplayer",
							"sid": 4724370751258157
						}
					],
					"actions": [
						{
							"id": "set-read-only",
							"objectClass": "ChatTextBox",
							"sid": 192445587260353,
							"parameters": {
								"mode": "not-read-only"
							}
						},
						{
							"id": "set-focused",
							"objectClass": "ChatTextBox",
							"sid": 4688975482978636
						},
						{
							"id": "set-enabled",
							"objectClass": "SendButton",
							"sid": 9548266046498608,
							"parameters": {
								"mode": "enabled"
							}
						}
					],
					"sid": 4360973053971621,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-host",
									"objectClass": "Multiplayer",
									"sid": 5856377662699346
								}
							],
							"actions": [
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 2921716968191661,
									"parameters": {
										"group-name": "\"Host\"",
										"state": "activated"
									}
								},
								{
									"callFunction": "AddLog",
									"sid": 701248976186461,
									"parameters": [
										"\"Joined the chat room as the host\""
									]
								},
								{
									"id": "add-item",
									"objectClass": "PeerList",
									"sid": 1314260363989239,
									"parameters": {
										"text": "Multiplayer.MyAlias & \" (host)\""
									}
								},
								{
									"callFunction": "Notify",
									"sid": 976016953237499,
									"parameters": [
										"\"You have joined the chat room as the host\"",
										"\"The System\""
									]
								}
							],
							"sid": 5413253118826669
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 6172107259838324
								}
							],
							"actions": [
								{
									"id": "set-group-active",
									"objectClass": "System",
									"sid": 6960390072013931,
									"parameters": {
										"group-name": "\"Peer\"",
										"state": "activated"
									}
								},
								{
									"callFunction": "AddLog",
									"sid": 431190699037760,
									"parameters": [
										"\"Joined the chat room as a peer\""
									]
								},
								{
									"id": "add-item",
									"objectClass": "PeerList",
									"sid": 9195129815194822,
									"parameters": {
										"text": "Multiplayer.MyAlias"
									}
								},
								{
									"callFunction": "Notify",
									"sid": 210909592832413,
									"parameters": [
										"\"you have joined the chat room as a peer\"",
										"\"The System\""
									]
								}
							],
							"sid": 2299233264770383
						}
					]
				},
				{
					"eventType": "comment",
					"text": "If we leave, disconnect or encounter an error, print that to the chat log as well."
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-left-room",
							"objectClass": "Multiplayer",
							"sid": 7362884614318793
						}
					],
					"actions": [
						{
							"callFunction": "AddLog",
							"sid": 767024007453235,
							"parameters": [
								"\"Left the chat room\""
							]
						},
						{
							"id": "set-enabled",
							"objectClass": "ChatTextBox",
							"sid": 8533611564876299,
							"parameters": {
								"mode": "disabled"
							}
						},
						{
							"id": "set-enabled",
							"objectClass": "SendButton",
							"sid": 4329934414758193,
							"parameters": {
								"mode": "disabled"
							}
						},
						{
							"id": "clear",
							"objectClass": "PeerList",
							"sid": 5705254172582482
						},
						{
							"callFunction": "Notify",
							"sid": 731781563186092,
							"parameters": [
								"\"you have left the chat room\"",
								"\"The System\""
							]
						}
					],
					"sid": 9837295563544924
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-disconnected",
							"objectClass": "Multiplayer",
							"sid": 5122722919059574
						}
					],
					"actions": [
						{
							"callFunction": "AddLog",
							"sid": 904606707513891,
							"parameters": [
								"\"Disconnected from signalling server. Trying to reconnect...\""
							]
						},
						{
							"id": "set-enabled",
							"objectClass": "ChatTextBox",
							"sid": 3991046870678704,
							"parameters": {
								"mode": "disabled"
							}
						},
						{
							"id": "set-enabled",
							"objectClass": "SendButton",
							"sid": 4867931834517871,
							"parameters": {
								"mode": "disabled"
							}
						},
						{
							"id": "clear",
							"objectClass": "PeerList",
							"sid": 9989466700308646
						},
						{
							"id": "connect",
							"objectClass": "Multiplayer",
							"sid": 979431011221741,
							"parameters": {
								"server": "\"wss://multiplayer.scirra.com\""
							}
						},
						{
							"callFunction": "Notify",
							"sid": 949735390330607,
							"parameters": [
								"\"You have been disconnected from signalling server. I am trying to reconnect\"",
								"\"The System\""
							]
						}
					],
					"sid": 4404376945898931
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-error",
							"objectClass": "Multiplayer",
							"sid": 7146598030310385
						}
					],
					"actions": [
						{
							"callFunction": "AddLog",
							"sid": 693232862414612,
							"parameters": [
								"\"Signalling error: \" & Multiplayer.ErrorMessage"
							]
						},
						{
							"callFunction": "Notify",
							"sid": 605145754533355,
							"parameters": [
								"Multiplayer.ErrorMessage",
								"\"There is a signalling error\""
							]
						}
					],
					"sid": 7714958481447735
				}
			],
			"sid": 3589093994402016
		},
		{
			"eventType": "group",
			"disabled": false,
			"title": "Chat",
			"description": "Manages sending chat messages and joining/leaving peers",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "group",
					"disabled": false,
					"title": "Common",
					"description": "Events that are common to both the host and peers.",
					"isActiveOnStart": true,
					"children": [
						{
							"eventType": "comment",
							"text": "When someone joins the chat, log a message in the chat box and add them to the peer list on the right."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-connected",
									"objectClass": "Multiplayer",
									"sid": 5876768870491098
								}
							],
							"actions": [
								{
									"callFunction": "AddLog",
									"sid": 197092107702699,
									"parameters": [
										"\"'\" & Multiplayer.PeerAlias & \"' has joined the server\""
									]
								},
								{
									"callFunction": "Notify",
									"sid": 255734696845802,
									"parameters": [
										"Multiplayer.PeerAlias & \"has joined the server\"",
										"\"The System\""
									]
								}
							],
							"sid": 6226821541915848,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 127526086823400,
											"parameters": {
												"first-value": "Multiplayer.PeerAlias",
												"comparison": 0,
												"second-value": "Multiplayer.HostAlias"
											}
										}
									],
									"actions": [
										{
											"id": "add-item",
											"objectClass": "PeerList",
											"sid": 382735599840704,
											"parameters": {
												"text": "Multiplayer.PeerAlias & \" (host)\""
											}
										}
									],
									"sid": 194024054752642
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "else",
											"objectClass": "System",
											"sid": 756971204311951
										}
									],
									"actions": [
										{
											"id": "add-item",
											"objectClass": "PeerList",
											"sid": 995854848274538,
											"parameters": {
												"text": "Multiplayer.PeerAlias"
											}
										}
									],
									"sid": 245503234369604
								}
							]
						},
						{
							"eventType": "comment",
							"text": "When someone leaves the chat, log a message in the chat box and remove them from the peer list on the right."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-disconnected",
									"objectClass": "Multiplayer",
									"sid": 2388523816790472
								}
							],
							"actions": [
								{
									"callFunction": "AddLog",
									"sid": 719858769519098,
									"parameters": [
										"\"'\" & Multiplayer.PeerAlias & \"' has left the server\""
									]
								},
								{
									"callFunction": "Notify",
									"sid": 281914024829861,
									"parameters": [
										"Multiplayer.PeerAlias & \"has left the server\"",
										"\"The System\""
									]
								}
							],
							"sid": 3645742830477446,
							"children": [
								{
									"eventType": "comment",
									"text": "To remove the right name we check every item in the list, and remove the item index where the item text matches the name of the peer who left."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "repeat",
											"objectClass": "System",
											"sid": 7065717110641537,
											"parameters": {
												"count": "PeerList.ItemCount"
											}
										},
										{
											"id": "compare-item-text-at",
											"objectClass": "PeerList",
											"sid": 3709328201846102,
											"parameters": {
												"index": "loopindex",
												"text-to-compare": "Multiplayer.PeerAlias",
												"case-sensitivity": "case-sensitive"
											}
										}
									],
									"actions": [
										{
											"id": "remove",
											"objectClass": "PeerList",
											"sid": 8701303809122579,
											"parameters": {
												"index": "loopindex"
											}
										}
									],
									"sid": 262424375448911
								}
							]
						},
						{
							"eventType": "comment",
							"text": "Log a message if we get kicked. This can happen if we could not connect to the host or if the host quit during the chat."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-kicked",
									"objectClass": "Multiplayer",
									"sid": 954328183678334
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 108768364921186,
									"parameters": {
										"variable": "ErrorText",
										"value": "\"You have been disconnected from the chat room\""
									}
								},
								{
									"callFunction": "AddLog",
									"sid": 808899606324145,
									"parameters": [
										"\"Disconnected from the server, returning to lobby...\""
									]
								},
								{
									"id": "set-enabled",
									"objectClass": "ChatTextBox",
									"sid": 3225724515838948,
									"parameters": {
										"mode": "disabled"
									}
								},
								{
									"id": "set-enabled",
									"objectClass": "SendButton",
									"sid": 3992457113091513,
									"parameters": {
										"mode": "disabled"
									}
								},
								{
									"id": "clear",
									"objectClass": "PeerList",
									"sid": 4639346644295153
								},
								{
									"callFunction": "AddLog",
									"sid": 986694406122686,
									"parameters": [
										"\"Leaving room...\""
									]
								},
								{
									"id": "disconnect-room",
									"objectClass": "Multiplayer",
									"sid": 835035115184467
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 856565207121201,
									"parameters": {
										"variable": "MyUsername",
										"value": "\"\""
									}
								},
								{
									"callFunction": "Notify",
									"sid": 128100451928316,
									"parameters": [
										"\"Disconnected from the server, returning to the lobby\"",
										"\"The System\""
									]
								}
							],
							"sid": 7521014600623974
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "Exit",
									"sid": 479189915349586
								}
							],
							"actions": [
								{
									"callFunction": "AddLog",
									"sid": 521411610189670,
									"parameters": [
										"\"Leaving room...\""
									]
								},
								{
									"id": "disconnect-room",
									"objectClass": "Multiplayer",
									"sid": 592454150297494
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 341053122638469,
									"parameters": {
										"variable": "MyUsername",
										"value": "\"\""
									}
								},
								{
									"callFunction": "Notify",
									"sid": 220705980938799,
									"parameters": [
										"\"Leaving room\"",
										"\"The System\""
									]
								}
							],
							"sid": 487792143358852,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "is-in-room",
											"objectClass": "Multiplayer",
											"sid": 940804471433700,
											"isInverted": true
										}
									],
									"actions": [
										{
											"id": "disconnect-signalling",
											"objectClass": "Multiplayer",
											"sid": 336155782108989
										}
									],
									"sid": 107290574548759
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-left-room",
									"objectClass": "Multiplayer",
									"sid": 440867157505429
								}
							],
							"actions": [
								{
									"id": "disconnect-signalling",
									"objectClass": "Multiplayer",
									"sid": 422744561884075
								}
							],
							"sid": 534698352127308
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-disconnected",
									"objectClass": "Multiplayer",
									"sid": 911911198937808
								}
							],
							"actions": [
								{
									"id": "go-to-layout",
									"objectClass": "System",
									"sid": 676760852556736,
									"parameters": {
										"layout": "Login"
									}
								}
							],
							"sid": 194281367573861
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "StopTTS",
									"sid": 930609696767681
								}
							],
							"actions": [
								{
									"id": "stop-speaking",
									"objectClass": "SpeechSynthesis",
									"sid": 880718767621413
								}
							],
							"sid": 278176504888934
						}
					],
					"sid": 5013846408573653
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Peer",
					"description": "Events specific to chat room peers (i.e. non-host users).",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Non-empty chat messages can be sent with the 'Send' button or just hitting return."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "SendButton",
									"sid": 6574369376651191
								},
								{
									"id": "on-key-pressed",
									"objectClass": "Keyboard",
									"sid": 7513737703851806,
									"parameters": {
										"key": 13
									}
								}
							],
							"actions": [],
							"sid": 6563839333510469,
							"children": [
								{
									"eventType": "comment",
									"text": "When we are a peer, we send our chat message to the host. The host will relay it to everyone else in the room."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "ChatTextBox",
											"sid": 1405230832798076,
											"parameters": {
												"text": "\"\"",
												"case": "case-insensitive"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"callFunction": "AddLog",
											"sid": 462277851431198,
											"parameters": [
												"\"<\" & Multiplayer.MyAlias & \"> \" & ChatTextBox.Text"
											]
										},
										{
											"id": "send-message",
											"objectClass": "Multiplayer",
											"sid": 1390783983483759,
											"parameters": {
												"peer-id": "\"\"",
												"tag": "\"chat\"",
												"message": "ChatTextBox.Text",
												"mode": "reliable-ordered"
											}
										},
										{
											"id": "set-text",
											"objectClass": "ChatTextBox",
											"sid": 6174097170721546,
											"parameters": {
												"text": "\"\""
											}
										},
										{
											"id": "play",
											"objectClass": "Audio",
											"sid": 616788299092002,
											"parameters": {
												"audio-file": "when",
												"loop": "not-looping",
												"volume": "0",
												"tag-optional": "\"\""
											}
										}
									],
									"sid": 2369854820513741
								}
							],
							"isOrBlock": true
						},
						{
							"eventType": "comment",
							"text": "When we receive a chat message from someone else, add it to the chat log."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-message",
									"objectClass": "Multiplayer",
									"sid": 1856487506398269,
									"parameters": {
										"tag": "\"chat\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "AddLog",
									"sid": 670984306174920,
									"parameters": [
										"\"<\" & Multiplayer.FromAlias & \"> \" & Multiplayer.Message"
									]
								},
								{
									"callFunction": "Notify",
									"sid": 515132659267261,
									"parameters": [
										"Multiplayer.Message",
										"Multiplayer.FromAlias"
									]
								}
							],
							"sid": 6851704369510052
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-host",
									"objectClass": "Multiplayer",
									"sid": 871359149691874,
									"isInverted": true
								}
							],
							"actions": [
								{
									"id": "set-visible",
									"objectClass": "Kick",
									"sid": 566912205324994,
									"parameters": {
										"visibility": "invisible"
									}
								}
							],
							"sid": 133553293545612
						}
					],
					"sid": 4757423477898831
				},
				{
					"eventType": "group",
					"disabled": false,
					"title": "Host",
					"description": "Events specific to the chat room host.",
					"isActiveOnStart": false,
					"children": [
						{
							"eventType": "comment",
							"text": "Non-empty chat messages can be sent with the 'Send' button or just hitting return."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "SendButton",
									"sid": 1924576580611378
								},
								{
									"id": "on-key-pressed",
									"objectClass": "Keyboard",
									"sid": 8056590381576561,
									"parameters": {
										"key": 13
									}
								}
							],
							"actions": [],
							"sid": 4837197477274635,
							"children": [
								{
									"eventType": "comment",
									"text": "When we are the host, we immediately broadcast our own chat messages to everyone else in the room."
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-text",
											"objectClass": "ChatTextBox",
											"sid": 2864637623582438,
											"parameters": {
												"text": "\"\"",
												"case": "case-insensitive"
											},
											"isInverted": true
										}
									],
									"actions": [
										{
											"callFunction": "AddLog",
											"sid": 145531525674940,
											"parameters": [
												"\"<\" & Multiplayer.MyAlias & \"> \" & ChatTextBox.Text"
											]
										},
										{
											"id": "broadcast-message",
											"objectClass": "Multiplayer",
											"sid": 1096695275025561,
											"parameters": {
												"from-id": "\"\"",
												"tag": "\"chat\"",
												"message": "ChatTextBox.Text",
												"mode": "reliable-ordered"
											}
										},
										{
											"id": "set-text",
											"objectClass": "ChatTextBox",
											"sid": 8266229850771559,
											"parameters": {
												"text": "\"\""
											}
										},
										{
											"id": "play",
											"objectClass": "Audio",
											"sid": 799936415549312,
											"parameters": {
												"audio-file": "when",
												"loop": "not-looping",
												"volume": "0",
												"tag-optional": "\"\""
											}
										}
									],
									"sid": 4324730215438826
								}
							],
							"isOrBlock": true
						},
						{
							"eventType": "comment",
							"text": "When we receive a chat message from someone else, we add it to the chat log, but then we must also relay it to everyone else in the chat room so they can all see what each other are sending. Note that the 'Broadcast' action does not send to the 'From ID' peer - there's no point sending them back the same message they just sent to us."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-peer-message",
									"objectClass": "Multiplayer",
									"sid": 3232828019407507,
									"parameters": {
										"tag": "\"chat\""
									}
								}
							],
							"actions": [
								{
									"callFunction": "AddLog",
									"sid": 423687793959731,
									"parameters": [
										"\"<\" & Multiplayer.FromAlias & \"> \" & Multiplayer.Message"
									]
								},
								{
									"id": "broadcast-message",
									"objectClass": "Multiplayer",
									"sid": 5623041490551399,
									"parameters": {
										"from-id": "Multiplayer.FromID",
										"tag": "\"chat\"",
										"message": "Multiplayer.Message",
										"mode": "reliable-ordered"
									}
								},
								{
									"callFunction": "Notify",
									"sid": 617459679794328,
									"parameters": [
										"Multiplayer.Message",
										"Multiplayer.FromAlias"
									]
								}
							],
							"sid": 7403461832285971
						},
						{
							"eventType": "comment",
							"text": "Pops up a notification box to kick users"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "Kick",
									"sid": 285601383144216
								}
							],
							"actions": [
								{
									"id": "set-height",
									"objectClass": "ChatLog",
									"sid": 395317135704588,
									"parameters": {
										"height": "41"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickTxt",
									"sid": 337534180230617,
									"parameters": {
										"visibility": "visible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickSelect",
									"sid": 565463790485735,
									"parameters": {
										"visibility": "visible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickButton",
									"sid": 186383660898316,
									"parameters": {
										"visibility": "visible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "CancelKick",
									"sid": 484117994685268,
									"parameters": {
										"visibility": "visible"
									}
								},
								{
									"id": "clear",
									"objectClass": "KickSelect",
									"sid": 627721528853921
								}
							],
							"sid": 519003779421835,
							"children": [
								{
									"eventType": "comment",
									"text": "This adds the list of players to the drop down menu. It loops for the number of users, and adds the users in the list by index, so 0 would represent the host, and 1 would represent the next user"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "repeat",
											"objectClass": "System",
											"sid": 854312019742951,
											"parameters": {
												"count": "Multiplayer.PeerCount"
											}
										}
									],
									"actions": [
										{
											"id": "add-item",
											"objectClass": "KickSelect",
											"sid": 708121415979305,
											"parameters": {
												"text": "Multiplayer.PeerAliasAt(loopindex)"
											}
										}
									],
									"sid": 965400748474773
								}
							]
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-start-of-layout",
									"objectClass": "System",
									"sid": 650312481759674
								}
							],
							"actions": [
								{
									"id": "set-height",
									"objectClass": "ChatLog",
									"sid": 258683901082620,
									"parameters": {
										"height": "441"
									}
								},
								{
									"id": "set-position",
									"objectClass": "ChatLog",
									"sid": 867466314276210,
									"parameters": {
										"x": "6",
										"y": "6"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickTxt",
									"sid": 931737457671373,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickSelect",
									"sid": 441724910163059,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickButton",
									"sid": 659625430105248,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "CancelKick",
									"sid": 989579979867431,
									"parameters": {
										"visibility": "invisible"
									}
								}
							],
							"sid": 838996971811142
						},
						{
							"eventType": "comment",
							"text": "Notice how we have to make the chat log smaller: this is because hiding it would remove yourself from the room, and objects would disappear behind it also."
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "CancelKick",
									"sid": 471841844552966
								}
							],
							"actions": [
								{
									"id": "set-visible",
									"objectClass": "KickTxt",
									"sid": 171807574164389,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickSelect",
									"sid": 769467533439205,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickButton",
									"sid": 803796767294461,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "CancelKick",
									"sid": 543671395945112,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-height",
									"objectClass": "ChatLog",
									"sid": 182315078638568,
									"parameters": {
										"height": "441"
									}
								},
								{
									"id": "set-position",
									"objectClass": "ChatLog",
									"sid": 987645371735748,
									"parameters": {
										"x": "6",
										"y": "6"
									}
								}
							],
							"sid": 244169742456987
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-host",
									"objectClass": "Multiplayer",
									"sid": 543049513081347
								}
							],
							"actions": [
								{
									"id": "set-visible",
									"objectClass": "Kick",
									"sid": 627485983874689,
									"parameters": {
										"visibility": "visible"
									}
								}
							],
							"sid": 229685997070127
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "on-clicked",
									"objectClass": "KickButton",
									"sid": 375366477008871
								}
							],
							"actions": [
								{
									"id": "kick-peer",
									"objectClass": "Multiplayer",
									"sid": 599874853012057,
									"parameters": {
										"peer-id": "Multiplayer.PeerIDAt(KickSelect.SelectedIndex)",
										"reason": "\"You have been manually kicked by the host\""
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickTxt",
									"sid": 936384113745868,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickSelect",
									"sid": 819332293359691,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "KickButton",
									"sid": 999032585347186,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "CancelKick",
									"sid": 170538860875911,
									"parameters": {
										"visibility": "invisible"
									}
								},
								{
									"id": "set-height",
									"objectClass": "ChatLog",
									"sid": 534828479257588,
									"parameters": {
										"height": "441"
									}
								},
								{
									"id": "set-position",
									"objectClass": "ChatLog",
									"sid": 509471618608025,
									"parameters": {
										"x": "6",
										"y": "6"
									}
								}
							],
							"sid": 518949600096962
						}
					],
					"sid": 3344262605949882
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-clicked",
							"objectClass": "Clear",
							"sid": 491285774242424
						}
					],
					"actions": [
						{
							"id": "set-text",
							"objectClass": "ChatLog",
							"sid": 622636657665976,
							"parameters": {
								"text": "\"The chat has been cleared\""
							}
						},
						{
							"callFunction": "Notify",
							"sid": 412676408277768,
							"parameters": [
								"\"The chat has been cleared\"",
								"\"The System\""
							]
						}
					],
					"sid": 418048955857234
				}
			],
			"sid": 4715640273336146
		}
	],
	"sid": 653061994218329
}